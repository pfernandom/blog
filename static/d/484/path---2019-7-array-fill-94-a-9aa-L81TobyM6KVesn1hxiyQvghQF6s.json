{"data":{"site":{"siteMetadata":{"title":"Pedro's Tech Blog","author":"Pedro Marquez"}},"markdownRemark":{"id":"4c838c2d-34f3-5da3-bee4-07ae9e3f841d","excerpt":"I was using JavaScript for completing some Leetcode challenges and I got some pretty weird behavior. I tried to create a matrix (a two-dimension array, or array…","html":"<p>I was using JavaScript for completing some Leetcode challenges and I got some pretty weird behavior.</p>\n<p>I tried to create a matrix (a two-dimension array, or array of arrays), initialize it with <code class=\"language-text\">false</code> and then use it in some backtracking problem. I did something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Initialize a 3x4 matrix with \"false\" values.</span>\n<span class=\"token keyword\">const</span> matrix <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// some stringify to capture the actual values at this point of the execution</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>matrix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// set middle value to true</span>\nmatrix<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>matrix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And my console prints this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">[</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">[</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">[</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">[</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Wait, what? If I only set the value at 1,1 to <strong>true</strong>, why am I getting changed values in the whole column?</p>\n<p>Well, this is because the parameter passed to <code class=\"language-text\">Array.fill()</code> is not really a callback. It only gets evaluated once, and its used for filling all the elements in the array.</p>\n<p>So, in this case, we have only two arrays. The array <code class=\"language-text\">A</code> (<code class=\"language-text\">Array(3)</code>), which has 3 elements, and array <code class=\"language-text\">B</code> (<code class=\"language-text\">Array(4)</code>) which has 4 elements. </p>\n<p><code class=\"language-text\">Array(4)</code> creates array <code class=\"language-text\">B</code>, and <code class=\"language-text\">B</code> is passed as parameter to the <code class=\"language-text\">Array(3).fill(B)</code>.</p>\n<p>To be clearer, this is what we are actually doing, broken into more steps:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">B</span> <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">A</span> <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token constant\">B</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> matrix <span class=\"token operator\">=</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As we can see, we’re filling <code class=\"language-text\">A</code> with the same reference of <code class=\"language-text\">B</code>, three times. Any changes to <code class=\"language-text\">B</code> will be reflected in each element of <code class=\"language-text\">A</code>.</p>\n<h3>How do we fix it?</h3>\n<p>Try this instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> matrix <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will create array <code class=\"language-text\">A</code>, and then use the <code class=\"language-text\">map</code> function to call <code class=\"language-text\">Array(4).fill(false)</code> once per each element of <code class=\"language-text\">A</code>, generating new arrays for each one.</p>\n<p>Looking back at why the problem happened, it seems pretty obvious. However, when I was puzzled when it first happened, and I couldn’t find any example of anyone else doing the same.</p>\n<p>Hope this helps other people.</p>\n<p>PS. Happy birthday, USA!</p>","frontmatter":{"title":"Weird behavior for matrix created with Array.fill()","date":"July 04, 2019","description":"I tried to initialize a two-dimension array with Array.fill() and now weird stuff is happening when I use it. Why??"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019/7/array-fill/","previous":{"fields":{"slug":"/2019/6/html-chunking/"},"frontmatter":{"title":"Streaming HTML responses"}},"next":{"fields":{"slug":"/2019/"},"frontmatter":{"title":"What happens when you click on the browser's \"back\" button?"}}}}